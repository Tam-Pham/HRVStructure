---
output: html_document
editor_options: 
  chunk_output_type: console
---


### Comparison of Structures


```{r, message=FALSE, warning=FALSE}
# Initialize matrix
m <- matrix(data=NA, nrow=nrow(table_clusters), ncol=nrow(table_clusters), dimnames = list(table_clusters$Index, table_clusters$Index))


for(row in row.names(m)) {
  for(col in colnames(m)) {
    if(row == col) {
      m[row, col] <- 1
      next
    } 
    subset <- table_clusters[table_clusters$Index %in% c(row, col), ]
    rez <- sapply(subset[2:ncol(subset)], function(x) ifelse(length(unique(x[!is.na(x)])) == 1, 1, 0))
    m[row, col] <- sum(rez) / length(rez)
  }
}
```


```{r, message=FALSE, warning=FALSE}
m <- correlation::cor_sort(m, distance = "raw", hclust_method = "ward.D2")

m %>% 
  as.data.frame() %>% 
  rownames_to_column("Index1") %>% 
  datawizard::reshape_longer(cols = hrv_cols, colnames_to = "Index2", values_to = "Probability") %>% 
  mutate(Index1 = factor(Index1, levels = row.names(m)),
         Index2 = factor(Index2, levels = rev(row.names(m)))) %>% 
  ggplot(aes(x = Index1, y = Index2)) +
  geom_tile(aes(fill = Probability))
```

### Summary

```{r, message=FALSE, warning=FALSE}
hclust(as.dist(m)) %>% 
  plot_dendrogram(clusters = NULL, ylim = -0.3, nudge_y = -0.02, angle = 90, points = FALSE)
```

