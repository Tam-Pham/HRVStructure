---
output: html_document
editor_options: 
  chunk_output_type: console
---


### Dimension Reduction

#### Factor Analysis 

##### How many factors

```{r, message=FALSE, warning=FALSE}
set.seed(3)

r <- correlation::correlation(data[hrv_cols]) %>% 
  as.matrix() %>% 
  correlation::cor_smooth(verbose = FALSE)

n <- parameters::n_factors(data, cor=r, type = "FA", package = "all")

n

plot(n) 
```

##### 3-factors

```{r, message=FALSE, warning=FALSE, fig.width=15, fig.height=15}
efa <- parameters::factor_analysis(data, cor=r, n=3, rotation="oblimin", fm="ml")

insight::display(efa, threshold="max", sort=TRUE)

plot(efa)

table_clusters <- parameters::closest_component(efa) %>% 
  data.frame(Index = names(.),
             EFA_3 = .) %>% 
  mutate(EFA_3 = as.character(EFA_3)) %>% 
  datawizard::data_rename_rows()
```

##### 9-factors

```{r, message=FALSE, warning=FALSE, fig.width=15, fig.height=15}
efa <- parameters::factor_analysis(data, cor=r, n=9, rotation="oblimin", fm="ml")

insight::display(efa, threshold="max", sort=TRUE)

plot(efa)

table_clusters$EFA_9 <- as.character(parameters::closest_component(efa))
```

