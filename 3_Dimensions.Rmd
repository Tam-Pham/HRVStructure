---
output: html_document
editor_options: 
  chunk_output_type: console
---


<!-- ```{r, message=FALSE, warning=FALSE} -->
<!-- nans <- data %>%  -->
<!--   group_by(Database) %>%  -->
<!--   select(one_of(hrv_cols)) %>%  -->
<!--   summarise_all(function(x) sum(is.na(x)) / n()) -->
<!-- nans <- nans[sapply(nans, function(x) if(is.character(x)) return(TRUE) else sum(x) > 0)] -->
<!-- nans -->

<!-- data %>%  -->
<!--   filter(is.na(RMSSD)) %>%  -->
<!--   select(Participant, Database) -->
<!-- ``` -->



### Dimension Reduction
PCA and EFA are both dimension reduction techniques that aim to group the observed variables into smaller sets of constructs. While PCA aims to extract the sets/ components that can explain all or most of the variance present in the observed variables, EFA focuses on the variance that is shared among the variables and looks for sets/ factors that could explain the correlations among them.

#### Principal Component Analysis
##### How many components
```{r, message=FALSE, warning=FALSE}
r <- correlation::correlation(data[hrv_cols]) %>% 
  as.matrix() %>% 
  correlation::cor_smooth(verbose = FALSE)

set.seed(3)
n <- parameters::n_components(data[hrv_cols], cor=r, rotation = "promax")

n

plot(n) 
```

##### 3-components
```{r, message=FALSE, warning=FALSE}
set.seed(3)

pca <- parameters::principal_components(data[hrv_cols], n=3, rotation = "promax")

insight::display(pca, threshold="max", sort=TRUE)

plot(pca)

table_clusters <- parameters::closest_component(pca) %>% 
  data.frame(Index = names(.),
             PCA_3 = .) %>% 
  mutate(PCA_3 = as.character(PCA_3)) %>% 
  datawizard::data_rename_rows()
```

##### 11-components
```{r, message=FALSE, warning=FALSE}
set.seed(3)

pca <- parameters::principal_components(data[hrv_cols], n=11, rotation = "promax")

insight::display(pca, threshold="max", sort=TRUE)

plot(pca)

table_clusters$PCA_11 <- as.character(parameters::closest_component(pca))

```

#### Factor Analysis 

##### How many factors

```{r, message=FALSE, warning=FALSE}
n <- parameters::n_factors(data[hrv_cols], cor=r, type = "FA", package = "all")

n

plot(n) 
```

##### 3-factors

```{r, message=FALSE, warning=FALSE}
set.seed(3)

efa <- parameters::factor_analysis(data[hrv_cols], cor=r, n=3, rotation="oblimin", fm="ml")

insight::display(efa, threshold="max", sort=TRUE)

plot(efa)

table_clusters$EFA_3 <- as.character(parameters::closest_component(efa))
```

##### 11-factors

```{r, message=FALSE, warning=FALSE}
set.seed(3)

efa <- parameters::factor_analysis(data[hrv_cols], cor=r, n=11, rotation="oblimin", fm="ml")

insight::display(efa, threshold="max", sort=TRUE)

plot(efa)

table_clusters$EFA_11 <- as.character(parameters::closest_component(efa))
```

